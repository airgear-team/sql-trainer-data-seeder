<div class="container">
  <h2>Оновлення кількох стовпців</h2>

  <p>
    За допомогою запиту <code>UPDATE</code> можна оновлювати значення кількох стовпців одночасно. У цьому випадку
    базовий запит має вигляд:
  </p>

  <pre class="sqlCodeBlock">UPDATE таблиця
SET поле1 = вираз1, поле2 = вираз2;</pre>

  <p>
    На складі, окрім зберігання та отримання книг, здійснюється також їх оптова продаж. Для цього в таблицю
    <code>book</code> додано стовпець <code>buy</code>.
  </p>

  <h3>Структура таблиці <code>book</code></h3>
  <table class="tableSql">
    <thead>
      <tr>
        <th>book_id</th>
        <th>title</th>
        <th>author</th>
        <th>price</th>
        <th>amount</th>
        <th>buy</th>
      </tr>
    </thead>
    <thead>
      <tr>
        <th><em>INT PRIMARY KEY AUTO_INCREMENT</em></th>
        <th><em>VARCHAR(50)</em></th>
        <th><em>VARCHAR(30)</em></th>
        <th><em>DECIMAL(8,2)</em></th>
        <th><em>INT</em></th>
        <th><em>INT</em></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td>Мастер и Маргарита</td>
        <td>Булгаков М.А.</td>
        <td>670.99</td>
        <td>3</td>
        <td>0</td>
      </tr>
      <tr>
        <td>2</td>
        <td>Белая гвардия</td>
        <td>Булгаков М.А.</td>
        <td>540.50</td>
        <td>5</td>
        <td>3</td>
      </tr>
      <tr>
        <td>3</td>
        <td>Идиот</td>
        <td>Достоевский Ф.М.</td>
        <td>460.00</td>
        <td>10</td>
        <td>8</td>
      </tr>
      <tr>
        <td>4</td>
        <td>Братья Карамазовы</td>
        <td>Достоевский Ф.М.</td>
        <td>799.01</td>
        <td>2</td>
        <td>0</td>
      </tr>
      <tr>
        <td>5</td>
        <td>Стихотворения и поэмы</td>
        <td>Есенин С.А.</td>
        <td>650.00</td>
        <td>15</td>
        <td>18</td>
      </tr>
    </tbody>
  </table>


  <h3>Приклад</h3>
  <p>
    У стовпці <code>buy</code> покупець зазначає кількість книг, які хоче придбати. Для кожної книги потрібно зменшити
    кількість на складі на відповідне значення, а <code>buy</code> обнулити.
  </p>

  <p class="skewed">Запит:</p>
  <pre class="sqlCodeBlock">UPDATE book
SET amount = amount - buy,
    buy = 0;

SELECT * FROM book;</pre>

  <p class="skewed">Результат:</p>
  <pre class="sqlResultTable">Affected rows: 3
Query result:
+---------+-----------------------+------------------+--------+--------+-----+
| book_id | title                 | author           | price  | amount | buy |
+---------+-----------------------+------------------+--------+--------+-----+
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      | 0   |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 2      | 0   |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 2      | 0   |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      | 0   |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | -3     | 0   |
+---------+-----------------------+------------------+--------+--------+-----+</pre>

  <p>
    Як видно, без перевірки значень у стовпці <code>buy</code> можуть виникати помилки (негативна кількість).
  </p>

  <h3>Завдання</h3>
  <p>
    Потрібно відкоригувати значення <code>buy</code> так, щоб воно не перевищувало <code>amount</code>. Для книг, які не
    замовлені (тобто <code>buy = 0</code>), зменшити ціну на 10%.
  </p>

  <div id="toggle1" style="cursor: pointer;">
    <div>
      <span class="arrow-text"><strong>Результат</strong></span>
    </div>
  </div>
  <div id="hiddenText1" style="display:none;">
    <pre class="sqlResultTable">Affected rows: 3
Query result:
+---------+-----------------------+------------------+--------+--------+-----+
| book_id | title                 | author           | price  | amount | buy |
+---------+-----------------------+------------------+--------+--------+-----+
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 603.89 | 3      | 0   |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      | 3   |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     | 8   |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 719.11 | 2      | 0   |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     | 15  |
+---------+-----------------------+------------------+--------+--------+-----+</pre>
  </div>

    <p></p>


  <div id="toggle2" style="cursor: pointer;">
    <div>
      <span class="arrow-text"><strong>Пояснення</strong></span>
    </div>
  </div>
  <div id="hiddenText2" style="display:none;">
    <p>
      Запит повинен встановити <code>buy = amount</code>, якщо <code>buy &gt; amount</code>, і залишити без змін, якщо
      <code>buy &le; amount</code>.
      Для книг з <code>buy = 0</code> ціна знижується на 10%. Це досягається за допомогою функції <code>IF()</code>.
    </p>
    <pre class="sqlCodeBlock">UPDATE book
SET buy = IF(buy > amount, amount, buy),
    price = IF(buy = 0, price * 0.9, price);</pre>
  </div>

  <p></p>

  <div id="toggle3" style="cursor: pointer;">
    <div>
      <span class="arrow-text"><strong>Структура та наповнення таблиці <code>book</code></strong></span>
    </div>
  </div>
  <div id="hiddenText3" style="display:none;">
    <pre class="sqlResultTable">+---------+-----------------------+------------------+--------+--------+-----+
| book_id | title                 | author           | price  | amount | buy |
+---------+-----------------------+------------------+--------+--------+-----+
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      | 0   |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      | 3   |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     | 8   |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      | 0   |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     | 18  |
+---------+-----------------------+------------------+--------+--------+-----+</pre>
  </div>
</div>