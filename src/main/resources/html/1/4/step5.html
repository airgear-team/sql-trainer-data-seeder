<div class="container">
  <h2>Вкладений запит після SELECT</h2>

  <p>
    Вкладений запит може розміщуватися після ключового слова <code>SELECT</code>. У цьому випадку результат виконання
    запиту виводиться в окремому стовпці результуючої таблиці. При цьому результатом запиту може бути лише одне значення
    — тоді воно повторюється в усіх рядках. Також вкладений запит може використовуватись у виразах.
  </p>

  <h3>Приклад</h3>

  <p>Вивести інформацію про книги, кількість примірників яких відрізняється від середньої кількості примірників на
    складі більш ніж на 3, а також вказати середнє значення кількості примірників книг.</p>

  <p class="skewed">Запит:</p>
  <pre class="sqlCodeBlock">SELECT title, author, amount,
    (
     SELECT AVG(amount) 
     FROM book
    ) AS Середнє_кількість 
FROM book
WHERE ABS(amount - (SELECT AVG(amount) FROM book)) &gt; 3;</pre>

  <div id="toggle1" style="cursor: pointer;">
    <div>
      <span class="arrow-text"><strong>Пояснення</strong></span>
    </div>
  </div>

  <div id="hiddenText1" style="display:none;">
    <p>
      У запиті використовується функція модуля, яка дозволяє враховувати, що кількість може відхилятись від середнього
      значення як у більший, так і в менший бік.
    </p>
  </div>

  <p class="skewed">Результат:</p>
  <pre class="sqlResultTable">+-----------------------+------------------+--------+---------------------+
| title                 | author           | amount | Середнє_кількість   |
+-----------------------+------------------+--------+---------------------+
| Мастер и Маргарита    | Булгаков М.А.    | 3      | 7.6667              |
| Братья Карамазовы     | Достоевский Ф.М. | 3      | 7.6667              |
| Стихотворения и поэмы | Есенин С.А.      | 15     | 7.6667              |
+-----------------------+------------------+--------+---------------------+</pre>

  <p>У вкладеному запиті обчислюється середня кількість примірників книг на складі. Цей запит використовується і в умові
    відбору, і для створення стовпця <code>Середнє_кількість</code> у результуючій таблиці. Значення у стовпці однакові
    для всіх рядків, оскільки вкладений запит повертає лише одне значення.</p>

  <p>Середнє значення виглядає як дробове число. Отримане значення можна округлити вниз — до найближчого меншого цілого
    числа.</p>

  <p class="skewed">Запит:</p>
  <pre class="sqlCodeBlock">SELECT title, author, amount,
       FLOOR((SELECT AVG(amount) FROM book)) AS Середнє_кількість 
FROM book
WHERE ABS(amount - (SELECT AVG(amount) FROM book)) &gt; 3;</pre>

  <p class="skewed">Результат:</p>
  <pre class="sqlResultTable">+-----------------------+------------------+--------+---------------------+
| title                 | author           | amount | Середнє_кількість   |
+-----------------------+------------------+--------+---------------------+
| Мастер и Маргарита    | Булгаков М.А.    | 3      | 7                   |
| Братья Карамазовы     | Достоевский Ф.М. | 3      | 7                   |
| Стихотворения и поэмы | Есенин С.А.      | 15     | 7                   |
+-----------------------+------------------+--------+---------------------+</pre>

  <h3>Завдання</h3>

  <p>Порахувати, скільки і яких примірників книг потрібно замовити постачальникам, щоб на складі стало однакова
    кількість примірників кожної книги, що дорівнює найбільшому значенню кількості примірників однієї книги на складі.
    Вивести назву книги, її автора, поточну кількість примірників на складі та кількість книг до замовлення. Останньому
    стовпцю присвоїти ім’я <code>Замовлення</code>. У результат не включати книги, які замовляти не потрібно.</p>

 <div id="toggle2" style="cursor: pointer;">
  <div>
    <span class="arrow-text"><strong>Результат</strong></span>
  </div>
</div>

<div id="hiddenText2" style="display:none;">
  <pre class="sqlResultTable">+--------------------+------------------+--------+-------+
| title              | author           | amount | Заказ |
+--------------------+------------------+--------+-------+
| Мастер и Маргарита | Булгаков М.А.    | 3      | 12    |
| Белая гвардия      | Булгаков М.А.    | 5      | 10    |
| Идиот              | Достоевский Ф.М. | 10     | 5     |
| Братья Карамазовы  | Достоевский Ф.М. | 3      | 12    |
| Игрок              | Достоевский Ф.М. | 10     | 5     |
+--------------------+------------------+--------+-------+</pre>
</div>

<p></p>


<div id="toggle3" style="cursor: pointer;">
  <div>
    <span class="arrow-text"><strong>Пояснення</strong></span>
  </div>
</div>

<div id="hiddenText3" style="display:none;">
  <p>
    Оскільки книгу з максимальною кількістю примірників замовляти не потрібно, в умові відбору запиту вкажіть, що книгу з максимальним значенням кількості у результуючу таблицю не включати.
  </p>
</div>

<p></p>

<div id="toggle4" style="cursor: pointer;">
  <div>
    <span class="arrow-text"><strong>Структура та наповнення таблиці <code>book</code></strong></span>
  </div>
</div>

<div id="hiddenText4" style="display:none;">
  <pre class="sqlResultTable">+---------+-----------------------+------------------+--------+--------+
| book_id | title                 | author           | price  | amount |
+---------+-----------------------+------------------+--------+--------+
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |
+---------+-----------------------+------------------+--------+--------+</pre>
</div>

</div>