<div class="container">
  <h2>Вкладений запит, оператори ANY та ALL</h2>

  <p>
    Вкладений запит, що повертає кілька значень одного стовпця, можна використовувати для відбору записів за допомогою
    операторів <code>ANY</code> та <code>ALL</code> разом з операціями порівняння (<code>=</code>,
    <code>&lt;&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&gt;</code>).
  </p>

  <p>
    Оператори <code>ANY</code> і <code>ALL</code> використовуються в SQL для порівняння деякого значення з результатом
    вкладеного запиту, який повертає один стовпець. Тип даних стовпця вкладеного запиту повинен збігатися з типом даних,
    з яким відбувається порівняння.
  </p>

  <h3>Як працює ANY:</h3>
  <ul>
    <li><code>amount &gt; ANY (10, 12)</code> еквівалентно <code>amount &gt; 10</code></li>
    <li><code>amount &lt; ANY (10, 12)</code> еквівалентно <code>amount &lt; 12</code></li>
    <li><code>amount = ANY (10, 12)</code> еквівалентно <code>amount = 10 OR amount = 12</code>, або
      <code>amount IN (10, 12)</code>
    </li>
    <li><code>amount &lt;&gt; ANY (10, 12)</code> поверне всі записи з будь-яким значенням <code>amount</code>,
      включаючи 10 і 12</li>
  </ul>

  <h3>Як працює ALL:</h3>
  <ul>
    <li><code>amount &gt; ALL (10, 12)</code> еквівалентно <code>amount &gt; 12</code></li>
    <li><code>amount &lt; ALL (10, 12)</code> еквівалентно <code>amount &lt; 10</code></li>
    <li><code>amount = ALL (10, 12)</code> не поверне жодного запису, бо означає
      <code>amount = 10 AND amount = 12</code>
    </li>
    <li><code>amount &lt;&gt; ALL (10, 12)</code> поверне всі записи, де <code>amount</code> не дорівнює ні 10, ні 12
    </li>
  </ul>

  <p><strong>Увага!</strong> Оператори <code>ALL</code> і <code>ANY</code> можна використовувати тільки з вкладеними
    запитами. Наведені вище приклади з (10, 12) — лише ілюстрація роботи операторів. У SQL-запитах так писати не можна.
  </p>

  <p><strong>Приклад</strong></p>

  <p>Вивести інформацію про ті книги, кількість яких менша за найменше середнє значення кількості книг для кожного
    автора.</p>

  <p class="skewed">Запит:</p>

  <pre class="sqlCodeBlock">SELECT title, author, amount, price
FROM book
WHERE amount &lt; ALL (
        SELECT AVG(amount) 
        FROM book 
        GROUP BY author 
      );</pre>

  <p class="skewed">Результат:</p>

  <pre class="sqlResultTable">+--------------------+------------------+--------+--------+
| title              | author           | amount | price  |
+--------------------+------------------+--------+--------+
| Мастер и Маргарита | Булгаков М.А.    | 3      | 670.99 |
| Братья Карамазовы  | Достоевский Ф.М. | 3      | 799.01 |
+--------------------+------------------+--------+--------+</pre>


  <div id="toggle1" style="cursor: pointer;">
    <div>
      <span class="arrow-text"><strong>Пояснення</strong></span>
    </div>
  </div>

  <div id="hiddenText1" style="display:none;">
    <ol>
      <li>
        Вкладений запит:
        <pre class="sqlCodeBlock">SELECT AVG(amount)
FROM book 
GROUP BY author</pre>


        повертає:
        <pre class="sqlResultTable">+-------------+
| AVG(amount) |
+-------------+
| 4.0000      |
| 7.6667      |
| 15.0000     |
+-------------+</pre>
      </li>
      <li>
        Умова основного запиту:
        <pre class="sqlCodeBlock">amount &lt; ALL ( 4.0000, 7.6667, 15.0000 )</pre>
        означає: <code>amount</code> має бути менше всіх значень, тобто менше <code>4.0000</code>.
      </li>
    </ol>

  </div>


  <p></p>


  <p>Таким чином, відібрано книги «Мастер и Маргарита» і «Братья Карамазовы» з кількістю примірників 3.</p>

  <h3>Інший приклад</h3>

  <p>Вивести інформацію про ті книги, кількість яких менша за найбільше середнє значення кількості книг кожного автора.
  </p>

  <p class="skewed">Запит:</p>

  <pre class="sqlCodeBlock">SELECT title, author, amount, price
FROM book
WHERE amount &lt; ANY (
        SELECT AVG(amount) 
        FROM book 
        GROUP BY author 
      );</pre>

  <p class="skewed">Результат:</p>

  <pre class="sqlResultTable">+--------------------+------------------+--------+--------+
| title              | author           | amount | price  |
+--------------------+------------------+--------+--------+
| Мастер и Маргарита | Булгаков М.А.    | 3      | 670.99 |
| Белая гвардия      | Булгаков М.А.    | 5      | 540.50 |
| Идиот              | Достоевский Ф.М. | 10     | 460.00 |
| Братья Карамазовы  | Достоевский Ф.М. | 3      | 799.01 |
| Игрок              | Достоевский Ф.М. | 10     | 480.50 |
+--------------------+------------------+--------+--------+</pre>


  <p></p>

  <div id="toggle3" style="cursor: pointer;">
    <div>
      <span class="arrow-text"><strong>Пояснення</strong></span>
    </div>
  </div>

  <div id="hiddenText3" style="display:none;">

    <p>Цей запит <code>amount &lt; ANY (4.0000, 7.6667, 15.0000)</code> означає, що <code>amount</code> має бути меншим
      за
      хоча б одне зі значень — тобто меншим за 15.0000.</p>
  </div>

  <p></p>


  <h3>Завдання</h3>

  <p>Вивести інформацію про книги (автор, назва, ціна), ціна яких менша за найбільшу з мінімальних цін, обчислених для
    кожного автора.</p>

  <div id="toggle4" style="cursor: pointer;">
    <div>
      <span class="arrow-text"><strong>Результат</strong></span>
    </div>
  </div>

  <div id="hiddenText4" style="display:none;">
    <pre class="sqlResultTable">+------------------+---------------+--------+
| author           | title         | price  |
+------------------+---------------+--------+
| Булгаков М.А.    | Белая гвардия | 540.50 |
| Достоевский Ф.М. | Идиот         | 460.00 |
| Достоевский Ф.М. | Игрок         | 480.50 |
+------------------+---------------+--------+</pre>
  </div>

  <p></p>

  <div id="toggle5" style="cursor: pointer;">
    <div>
      <span class="arrow-text"><strong>Структура та наповнення таблиці book</strong></span>
    </div>
  </div>

  <div id="hiddenText5" style="display:none;">
    <pre class="sqlResultTable">+---------+-----------------------+------------------+--------+--------+
| book_id | title                 | author           | price  | amount |
+---------+-----------------------+------------------+--------+--------+
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |
+---------+-----------------------+------------------+--------+--------+</pre>
  </div>

</div>