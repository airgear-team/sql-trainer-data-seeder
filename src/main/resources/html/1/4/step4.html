<div class="container">
  <h2>Вкладений запит, оператори ANY та ALL</h2>

  <p>
    Вкладений запит, що повертає кілька значень одного стовпця, можна використовувати для відбору записів за допомогою
    операторів <code>ANY</code> та <code>ALL</code> разом з операціями порівняння (<code>=</code>,
    <code>&lt;&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&gt;</code>).
  </p>

  <p>
    Оператори <code>ANY</code> і <code>ALL</code> використовуються в SQL для порівняння деякого значення з результатом
    вкладеного запиту, який повертає один стовпець. Тип даних стовпця вкладеного запиту повинен збігатися з типом даних,
    з яким відбувається порівняння.
  </p>

  <h3>Як працює ANY:</h3>
  <ul>
    <li><code>amount &gt; ANY (10, 12)</code> еквівалентно <code>amount &gt; 10</code></li>
    <li><code>amount &lt; ANY (10, 12)</code> еквівалентно <code>amount &lt; 12</code></li>
    <li><code>amount = ANY (10, 12)</code> еквівалентно <code>amount = 10 OR amount = 12</code>, або
      <code>amount IN (10, 12)</code>
    </li>
    <li><code>amount &lt;&gt; ANY (10, 12)</code> поверне всі записи, де <code>amount</code> не дорівнює одночасно 10 або 12</li>
  </ul>

  <h3>Як працює ALL:</h3>
  <ul>
    <li><code>amount &gt; ALL (10, 12)</code> еквівалентно <code>amount &gt; 12</code></li>
    <li><code>amount &lt; ALL (10, 12)</code> еквівалентно <code>amount &lt; 10</code></li>
    <li><code>amount = ALL (10, 12)</code> не поверне жодного запису, бо означає
      <code>amount = 10 AND amount = 12</code>
    </li>
    <li><code>amount &lt;&gt; ALL (10, 12)</code> поверне всі записи, де <code>amount</code> не дорівнює ні 10, ні 12
    </li>
  </ul>

  <p><strong>Увага!</strong> Оператори <code>ALL</code> і <code>ANY</code> можна використовувати тільки з вкладеними
    запитами. Наведені вище приклади з (10, 12) — лише ілюстрація роботи операторів. У SQL-запитах так писати не можна.
  </p>

  <p><strong>Приклад</strong></p>

  <p>Вивести інформацію про ті книги, кількість яких менша за найменше середнє значення кількості книг для кожного
    автора.</p>

  <p class="skewed">Запит:</p>

  <pre class="sqlCodeBlock">SELECT title, author, amount, price
FROM book
WHERE amount &lt; ALL (
        SELECT AVG(amount)
        FROM book
        GROUP BY author
      );</pre>

  <p class="skewed">Результат:</p>

  <pre class="sqlResultTable">Affected rows: 2
+----------------------+----------------------+--------+--------+
| title                | author               | amount | price  |
+----------------------+----------------------+--------+--------+
| Тіні забутих предків | Коцюбинський М.М.    | 3      | 670.99 |
| Хмари                | Нечуй-Левицький І.С. | 2      | 799.01 |
+----------------------+----------------------+--------+--------+</pre>


  <div id="toggle1" style="cursor: pointer;">
    <div>
      <span class="arrow-text"><strong>Пояснення</strong></span>
    </div>
  </div>

  <div id="hiddenText1" style="display:none;">
    <ol>
      <li>
        Вкладений запит:
        <pre class="sqlCodeBlock">SELECT AVG(amount)
FROM book
GROUP BY author</pre>

        повертає:
        <pre class="sqlResultTable">Affected rows: 4
+-------------+
| AVG(amount) |
+-------------+
| 4.0         |
| 7.6667      |
| 15.0        |
| 10.0        |
+-------------+</pre>
      </li>
      <li>
        Умова основного запиту:
        <pre class="sqlCodeBlock">amount &lt; ALL (4.0, 7.6667, 15.0, 10.0)</pre>
        означає: <code>amount</code> має бути менше всіх значень, тобто менше <code>2.0</code>.
      </li>
    </ol>

  </div>

  <p>Таким чином, відібрано книги «Тіні забутих предків» і «Хмари» з кількістю примірників, що менше всіх середніх значень по авторам.</p>

  <h3>Інший приклад</h3>

  <p>Вивести інформацію про ті книги, кількість яких менша за найбільше середнє значення кількості книг кожного автора.
  </p>

  <p class="skewed">Запит:</p>

  <pre class="sqlCodeBlock">SELECT title, author, amount, price
FROM book
WHERE amount &lt; ANY (
        SELECT AVG(amount)
        FROM book
        GROUP BY author
      );</pre>

  <p class="skewed">Результат:</p>

  <pre class="sqlResultTable">Affected rows: 5
+----------------------+----------------------+--------+--------+
| title                | author               | amount | price  |
+----------------------+----------------------+--------+--------+
| Тіні забутих предків | Коцюбинський М.М.    | 3      | 670.99 |
| Intermezzo           | Коцюбинський М.М.    | 5      | 540.5  |
| Кайдашева сім’я      | Нечуй-Левицький І.С. | 10     | 460    |
| Хмари                | Нечуй-Левицький І.С. | 2      | 799.01 |
| Нове життя           | Петренко П.П.        | 10     | 480.5  |
+----------------------+----------------------+--------+--------+</pre>

  <div id="toggle3" style="cursor: pointer;">
    <div>
      <span class="arrow-text"><strong>Пояснення</strong></span>
    </div>
  </div>

  <div id="hiddenText3" style="display:none;">

    <p>Цей запит <code>amount &lt; ANY (4.0, 7.6667, 15.0, 10.0)</code> означає, що <code>amount</code> має бути меншим
      хоча б за одне зі значень середніх кількостей книг по авторам.</p>
  </div>

  <h3>Завдання</h3>

  <p>Вивести інформацію про книги (автор, назва, ціна), ціна яких менша за найбільшу з мінімальних цін, обчислених для
    кожного автора.</p>

  <div id="toggle4" style="cursor: pointer;">
    <div>
      <span class="arrow-text"><strong>Результат</strong></span>
    </div>
  </div>

  <div id="hiddenText4" style="display:none;">
    <pre class="sqlResultTable">+----------------------+-----------------+-------+
| author               | title           | price |
+----------------------+-----------------+-------+
| Нечуй-Левицький І.С. | Кайдашева сім’я | 460   |
| Петренко П.П.        | Нове життя      | 480.5 |
| Коцюбинський М.М.    | Intermezzo      | 540.5 |
+----------------------+-----------------+-------+</pre>
  </div>

  <div id="toggle5" style="cursor: pointer;">
    <div>
      <span class="arrow-text"><strong>Структура та наповнення таблиці book</strong></span>
    </div>
  </div>

  <div id="hiddenText5" style="display:none;">
    <pre class="sqlResultTable">+---------+----------------------+----------------------+--------+--------+
| book_id | title                | author               | amount | price  |
+---------+----------------------+----------------------+--------+--------+
| 1       | Тіні забутих предків | Коцюбинський М.М.    | 3      | 670.99 |
| 2       | Intermezzo           | Коцюбинський М.М.    | 5      | 540.5  |
| 3       | Кайдашева сім’я      | Нечуй-Левицький І.С. | 10     | 460    |
| 4       | Хмари                | Нечуй-Левицький І.С. | 2      | 799.01 |
| 5       | Земля                | Кобилянська О.Ю.     | 15     | 650    |
| 6       | Нове життя           | Петренко П.П.        | 10     | 480.5  |
+---------+----------------------+----------------------+--------+--------+</pre>
  </div>

</div>