<div class="container">

    <h2>Видалення записів головної таблиці з збереженням записів у залежній</h2>

    <p>
        При створенні таблиці для зовнішніх ключів за допомогою <code>ON DELETE</code> встановлюються опції,
        які визначають дії, що виконуються при видаленні пов’язаної строки з головної таблиці.
    </p>

    <p>
        Якщо задано <code>SET NULL</code>, то при видаленні пов’язаної строки з головної таблиці в залежній таблиці
        у стовпці зовнішнього ключа встановлюється значення <code>NULL</code> (за умови, що у цьому стовпці
        допускаються значення <code>NULL</code>).
    </p>

    <p>
        В таблиці <code>book</code> ця опція встановлена для поля <code>genre_id</code>.
    </p>

    <h3>Приклад</h3>

    <p>
        Видалимо з таблиці <code>genre</code> усі жанри, назва яких закінчується на «я», а в таблиці <code>book</code>
        для цих жанрів встановимо значення <code>NULL</code>.
    </p>

    <p class="skewed">Запит:</p>
    <pre class="sqlResultTable">DELETE FROM genre
WHERE name_genre LIKE "%я";

SELECT * FROM genre;
SELECT * FROM book;
</pre>

    <p class="skewed">Результат:</p>
    <pre class="sqlResultTable">Affected rows: 2

Query result:
+----------+------------+
| genre_id | name_genre |
+----------+------------+
| 1        | Роман      |
+----------+------------+
Affected rows: 1

Query result:
+---------+-----------------------+-----------+----------+--------+--------+
| book_id | title                 | author_id | genre_id | price  | amount |
+---------+-----------------------+-----------+----------+--------+--------+
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 12     |
| 3       | Идиот                 | 2         | 1        | 437.11 | 13     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | NULL     | 650.00 | 15     |
| 7       | Черный человек        | 3         | NULL     | 570.20 | 12     |
| 8       | Лирика                | 4         | NULL     | 518.99 | 2      |
| 9       | Доктор Живаго         | 4         | 1        | 380.80 | 4      |
| 10      | Стихотворения и поэмы | 5         | NULL     | 255.90 | 4      |
| 11      | Остров сокровищ       | 6         | NULL     | 599.99 | 5      |
+---------+-----------------------+-----------+----------+--------+--------+
Affected rows: 11
</pre>

    <p>
        В нашому випадку було видалено жанри «Поезія» та «Пригоди».
    </p>

    <h3>Завдання</h3>
    <p>
        Видалити всі жанри, до яких належить менше 4-х найменувань книг. В таблиці <code>book</code> для цих жанрів
        встановити значення <code>NULL</code>.
    </p>

    <div id="toggle0" style="cursor: pointer;">
        <div><span class="arrow-text"><strong>Пояснення</strong></span></div>
    </div>
    <div id="hiddenText0" style="display:none;">
        <p>
            У запиті слід рахувати всі унікальні книги. Наприклад, книги «Стихотворения и поэмы» написані різними
            авторами і мають різний <code>book_id</code>, тобто це різні книги.
            Для відбору жанрів, до яких належить менше 4-х книг, використовуйте вкладений запит.
        </p>
    </div>

    <p></p>
    <div id="toggle1" style="cursor: pointer;">
        <div><span class="arrow-text"><strong>Результат</strong></span></div>
    </div>
    <div id="hiddenText1" style="display:none;">
        <pre class="sqlResultTable">Query result:
+----------+------------+
| genre_id | name_genre |
+----------+------------+
| 1        | Роман      |
| 2        | Поезия     |
+----------+------------+
Affected rows: 2

Query result:
+---------+-----------------------+-----------+----------+--------+--------+
| book_id | title                 | author_id | genre_id | price  | amount |
+---------+-----------------------+-----------+----------+--------+--------+
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 12     |
| 3       | Идиот                 | 2         | 1        | 437.11 | 13     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 12     |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |
| 9       | Доктор Живаго         | 4         | 1        | 380.80 | 4      |
| 10      | Стихотворения и поэмы | 5         | 2        | 255.90 | 4      |
| 11      | Остров сокровищ       | 6         | NULL     | 599.99 | 5      |
+---------+-----------------------+-----------+----------+--------+--------+
Affected rows: 11
</pre>
    </div>

    <p></p>

    <div id="toggle2" style="cursor: pointer;">
        <div><span class="arrow-text"><strong>Структура</strong></span></div>
    </div>
    <div id="hiddenText2" style="display:none;">
        <pre class="sqlResultTable">Таблиця book
+---------+-----------------------+-----------+----------+--------+--------+
| book_id | title                 | author_id | genre_id | price  | amount |
+---------+-----------------------+-----------+----------+--------+--------+
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 12     |
| 3       | Идиот                 | 2         | 1        | 437.11 | 13     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 12     |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |
| 9       | Доктор Живаго         | 4         | 1        | 380.80 | 4      |
| 10      | Стихотворения и поэмы | 5         | 2        | 255.90 | 4      |
| 11      | Остров сокровищ       | 6         | 3        | 599.99 | 5      |
+---------+-----------------------+-----------+----------+--------+--------+

Таблиця supply
+-----------+-----------------------+------------------+--------+--------+
| supply_id | title                 | author           | price  | amount |
+-----------+-----------------------+------------------+--------+--------+
| 1         | Доктор Живаго         | Пастернак Б.Л.   | 380.80 | 4      |
| 2         | Черный человек        | Есенин С.А.      | 570.20 | 6      |
| 3         | Белая гвардия         | Булгаков М.А.    | 540.50 | 7      |
| 4         | Идиот                 | Достоевский Ф.М. | 360.80 | 3      |
| 5         | Стихотворения и поэмы | Лермонтов М.Ю.   | 255.90 | 4      |
| 6         | Остров сокровищ       | Стивенсон Р.Л.   | 599.99 | 5      |
+-----------+-----------------------+------------------+--------+--------+

Таблиця author                          Таблиця genre
+-----------+------------------+	+----------+-------------+			
| author_id | name_author      |	| genre_id | name_genre  |			
+-----------+------------------+	+----------+-------------+			
| 1         | Булгаков М.А.    |	| 1        | Роман       |			
| 2         | Достоевский Ф.М. |	| 2        | Поэзия      |			
| 3         | Есенин С.А.      |	| 3        | Приключения |			
| 4         | Пастернак Б.Л.   |	+----------+-------------+			
| 5         | Лермонтов М.Ю.   |
| 6         | Стивенсон Р.Л.   |
+-----------+------------------+
</pre>
    </div>

</div>