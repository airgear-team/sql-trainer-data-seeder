<div class="container">

    <h2>Каскадне видалення записів пов’язаних таблиць</h2>

    <p>
        При створенні таблиці для зовнішніх ключів за допомогою <code>ON DELETE</code> встановлюються опції, які
        визначають дії,
        що виконуються при видаленні пов’язаної строки з головної таблиці.
    </p>

    <p>
        Зокрема, <code>ON DELETE CASCADE</code> автоматично видаляє рядки з залежної таблиці при видаленні пов’язаних
        рядків у головній таблиці.
    </p>

    <p>
        В таблиці <code>book</code> ця опція встановлена для поля <code>author_id</code>.
    </p>

    <h3>Приклад</h3>

    <p>
        Видалимо з таблиці <code>author</code> усіх авторів, прізвище яких починається на «Д», а з таблиці
        <code>book</code> — всі книги цих авторів.
    </p>

    <p class="skewed">Запит:</p>
    <pre class="sqlResultTable">DELETE FROM author
WHERE name_author LIKE "Д%";

SELECT * FROM author;
SELECT * FROM book;
</pre>

    <p class="skewed">Результат:</p>
    <pre class="sqlResultTable">Affected rows: 1

Query result:
+-----------+----------------+  
| author_id | name_author    |  
+-----------+----------------+  
| 1         | Булгаков М.А.  |  
| 3         | Есенин С.А.    |  
| 4         | Пастернак Б.Л. |  
| 5         | Лермонтов М.Ю. |  
| 6         | Стивенсон Р.Л. |  
+-----------+----------------+  

Affected rows: 5

Query result:
+---------+-----------------------+-----------+----------+--------+--------+
| book_id | title                 | author_id | genre_id | price  | amount |
+---------+-----------------------+-----------+----------+--------+--------+
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 12     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 12     |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |
| 9       | Доктор Живаго         | 4         | 1        | 380.80 | 4      |
| 10      | Стихотворения и поэмы | 5         | 2        | 255.90 | 4      |
| 11      | Остров сокровищ       | 6         | 3        | 599.99 | 5      |
+---------+-----------------------+-----------+----------+--------+--------+
</pre>

    <p>
        Одним запитом видаляються пов’язані записи з головної та залежної таблиць. У нашому випадку було видалено автора
        Достоєвського та всі його книги.
    </p>

    <h3>Завдання</h3>
    <p>
        Видалити усіх авторів та всі їхні книги, загальна кількість яких менша за 20.
    </p>

    <div id="toggle0" style="cursor: pointer;">
        <div><span class="arrow-text"><strong>Пояснення</strong></span></div>
    </div>
    <div id="hiddenText0" style="display:none;">
        <p>
            Для підрахунку кількості книг кожного автора використайте вкладений запит.
        </p>
    </div>

    <p></p>
    <div id="toggle1" style="cursor: pointer;">
        <div><span class="arrow-text"><strong>Результат</strong></span></div>
    </div>
    <div id="hiddenText1" style="display:none;">
        <pre class="sqlResultTable">Affected rows: 4

Query result:
+-----------+------------------+
| author_id | name_author      |
+-----------+------------------+
| 2         | Достоевский Ф.М. |
| 3         | Есенин С.А.      |
+-----------+------------------+

Affected rows: 2

Query result:
+---------+-----------------------+-----------+----------+--------+--------+
| book_id | title                 | author_id | genre_id | price  | amount |
+---------+-----------------------+-----------+----------+--------+--------+
| 3       | Идиот                 | 2         | 1        | 437.11 | 13     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 12     |
+---------+-----------------------+-----------+----------+--------+--------+
Affected rows: 5
</pre>
    </div>

    <p></p>

    <div id="toggle2" style="cursor: pointer;">
        <div><span class="arrow-text"><strong>Структура</strong></span></div>
    </div>
    <div id="hiddenText2" style="display:none;">
        <pre class="sqlResultTable">Таблиця book
+---------+-----------------------+-----------+----------+--------+--------+
| book_id | title                 | author_id | genre_id | price  | amount |
+---------+-----------------------+-----------+----------+--------+--------+
| 1       | Мастер и Маргарита    | 1         | 1        | 670.99 | 3      |
| 2       | Белая гвардия         | 1         | 1        | 540.50 | 12     |
| 3       | Идиот                 | 2         | 1        | 437.11 | 13     |
| 4       | Братья Карамазовы     | 2         | 1        | 799.01 | 3      |
| 5       | Игрок                 | 2         | 1        | 480.50 | 10     |
| 6       | Стихотворения и поэмы | 3         | 2        | 650.00 | 15     |
| 7       | Черный человек        | 3         | 2        | 570.20 | 12     |
| 8       | Лирика                | 4         | 2        | 518.99 | 2      |
| 9       | Доктор Живаго         | 4         | 1        | 380.80 | 4      |
| 10      | Стихотворения и поэмы | 5         | 2        | 255.90 | 4      |
| 11      | Остров сокровищ       | 6         | 3        | 599.99 | 5      |
+---------+-----------------------+-----------+----------+--------+--------+

Таблиця supply
+-----------+-----------------------+------------------+--------+--------+
| supply_id | title                 | author           | price  | amount |
+-----------+-----------------------+------------------+--------+--------+
| 1         | Доктор Живаго         | Пастернак Б.Л.   | 380.80 | 4      |
| 2         | Черный человек        | Есенин С.А.      | 570.20 | 6      |
| 3         | Белая гвардия         | Булгаков М.А.    | 540.50 | 7      |
| 4         | Идиот                 | Достоевский Ф.М. | 360.80 | 3      |
| 5         | Стихотворения и поэмы | Лермонтов М.Ю.   | 255.90 | 4      |
| 6         | Остров сокровищ       | Стивенсон Р.Л.   | 599.99 | 5      |
+-----------+-----------------------+------------------+--------+--------+

Таблиця author                          Таблиця genre
+-----------+------------------+	+----------+-------------+			
| author_id | name_author      |	| genre_id | name_genre  |			
+-----------+------------------+	+----------+-------------+			
| 1         | Булгаков М.А.    |	| 1        | Роман       |			
| 2         | Достоевский Ф.М. |	| 2        | Поезія      |			
| 3         | Есенин С.А.      |	| 3        | Пригоди    |			
| 4         | Пастернак Б.Л.   |	+----------+-------------+			
| 5         | Лермонтов М.Ю.   |
| 6         | Стивенсон Р.Л.   |
+-----------+------------------+	
</pre>
    </div>

</div>