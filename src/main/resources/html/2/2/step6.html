<div class="container">

    <h2>Запити до кількох таблиць із вкладеними запитами</h2>

    <p>
        У запитах, побудованих на кількох таблицях, можна використовувати вкладені запити. Вкладений запит може бути
        включений: після ключового слова <code>SELECT</code>, після <code>FROM</code> та в умову відбору після
        <code>WHERE</code> або <code>HAVING</code>.
    </p>

    <h3>Приклад</h3>

    <p>Вивести авторів, загальна кількість книг яких на складі є максимальною.</p>

    <p>Це досить складний запит, тому будемо розв’язувати його поетапно (реалізуючи кожен запит окремо), а потім
        об'єднаємо всі запити в один.</p>

    <p><strong>Крок 1.</strong> Знайдемо сумарну кількість книг на складі по кожному автору.</p>
    <p class="skewed">Запит:</p>
    <pre class="sqlResultTable">SELECT author_id, SUM(amount) AS sum_amount 
FROM book 
GROUP BY author_id;</pre>

    <p class="skewed">Результат:</p>
    <pre class="sqlResultTable">+-----------+------------+
| author_id | sum_amount |
+-----------+------------+
| 1         | 8          |
| 2         | 23         |
| 3         | 21         |
| 4         | 2          |
+-----------+------------+</pre>

    <p><strong>Крок 2.</strong> Знайдемо максимальне значення з попереднього результату.</p>
    <p class="skewed">Запит:</p>
    <pre class="sqlResultTable">SELECT MAX(sum_amount) AS max_sum_amount
FROM (
    SELECT author_id, SUM(amount) AS sum_amount
    FROM book
    GROUP BY author_id
) query_in;</pre>

    <p class="skewed">Результат:</p>
    <pre class="sqlResultTable">+----------------+
| max_sum_amount |
+----------------+
| 23             |
+----------------+</pre>

    <p><strong>Крок 3.</strong> Виведемо ПІБ автора і загальну кількість книг для кожного з них.</p>
    <p class="skewed">Запит:</p>
    <pre class="sqlResultTable">SELECT name_author, SUM(amount) AS Кількість
FROM author 
INNER JOIN book ON author.author_id = book.author_id
GROUP BY name_author;</pre>

    <p class="skewed">Результат:</p>
    <pre class="sqlResultTable">+------------------+------------+
| name_author      | Кількість  |
+------------------+------------+
| Булгаков М.А.    | 8          |
| Достоєвський Ф.М.| 23         |
| Єсенін С.А.      | 21         |
| Пастернак Б.Л.   | 2          |
+------------------+------------+</pre>

    <p><strong>Крок 4.</strong> Включимо запит з кроку 2 у фільтр <code>HAVING</code> для запиту з кроку 3:</p>
    <p class="skewed">Запит:</p>
    <pre class="sqlResultTable">SELECT name_author, SUM(amount) AS Кількість
FROM author 
INNER JOIN book ON author.author_id = book.author_id
GROUP BY name_author
HAVING SUM(amount) = (
    SELECT MAX(sum_amount)
    FROM (
        SELECT author_id, SUM(amount) AS sum_amount
        FROM book
        GROUP BY author_id
    ) query_in
);</pre>

    <p class="skewed">Результат:</p>
    <pre class="sqlResultTable">+------------------+------------+
| name_author      | Кількість  |
+------------------+------------+
| Достоєвський Ф.М.| 23         |
+------------------+------------+</pre>

    <h3>Завдання</h3>
    Вивести в алфавітному порядку всіх авторів, які пишуть лише в одному жанрі.
    Оскільки в наших таблицях дані занесені так, що в кожного автора книги лише одного жанру, для цього запиту ми
    внесемо зміни до таблиці <code>book</code>.
    Нехай книга Єсеніна «Чорна людина» належить до жанру «Роман», а книга Булгакова «Біла гвардія» — до
    «Пригод» (ці зміни вже внесені до таблиць).

    <p><strong>Логическая схема базы данных:</strong></p>

    <div data-img-id="2.2.4.3"></div>

    <p><strong>Текст завдання </strong> (щоб не прокручувати сторінку):</p>
    <p class="gray-quote">
        Вивести в алфавітному порядку всіх авторів, які пишуть лише в одному жанрі.
        Оскільки в наших таблицях дані занесені так, що в кожного автора книги лише одного жанру, для цього запиту ми
        внесемо зміни до таблиці <code>book</code>.
        Нехай книга Єсеніна «Чорна людина» належить до жанру «Роман», а книга Булгакова «Біла гвардія» — до
        «Пригод» (ці зміни вже внесені до таблиць).
    </p>

    <div id="toggle1" style="cursor: pointer;">
        <div><span class="arrow-text"><strong>Результат</strong></span></div>
    </div>
    <div id="hiddenText1" style="display:none;">
        <pre class="sqlResultTable">+------------------+
| name_author      |
+------------------+
| Достоєвський Ф.М.|
| Пастернак Б.Л.   |
+------------------+</pre>
    </div>

    <br>

    <div id="toggle2" style="cursor: pointer;">
        <div><span class="arrow-text"><strong>Структура та наповнення таблиць</strong></span></div>
    </div>
    <div id="hiddenText2" style="display:none;">
        <pre class="sqlResultTable">Таблиця genre:
+----------+-------------+
| genre_id | name_genre  |
+----------+-------------+
| 1        | Роман       |
| 2        | Поезія      |
| 3        | Пригоди     |
+----------+-------------+

Таблиця author:
+-----------+------------------+
| author_id | name_author      |
+-----------+------------------+
| 1         | Булгаков М.А.    |
| 2         | Достоєвський Ф.М.|
| 3         | Єсенін С.А.      |
| 4         | Пастернак Б.Л.   |
| 5         | Лермонтов М.Ю.   |
+-----------+------------------+

Таблиця book:
+---------+-----------------------+-----------+----------+--------+--------+
| book_id | title                 | author_id | genre_id | price  | amount |
+---------+-----------------------+-----------+----------+--------+--------+
| 1       | Майстер і Маргарита   | 1         | 1        | 670.99 | 3      |
| 2       | Біла гвардія          | 1         | 3        | 540.50 | 5      |
| 3       | Ідіот                 | 2         | 1        | 460.00 | 10     |
| 4       | Брати Карамазови      | 2         | 1        | 799.01 | 3      |
| 5       | Гравець               | 2         | 1        | 480.50 | 10     |
| 6       | Вірші та поеми        | 3         | 2        | 650.00 | 15     |
| 7       | Чорна людина          | 3         | 1        | 570.20 | 6      |
| 8       | Лірика                | 4         | 2        | 518.99 | 2      |
+---------+-----------------------+-----------+----------+--------+--------+</pre>
    </div>

</div>